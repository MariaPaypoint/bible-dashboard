# Эндпоинт GET /excerpt_with_alignment

## Описание
Эндпоинт предоставляет текст отрывка из Библии вместе с данными временной разметки (alignment) для аудио. Позволяет получить один или несколько отрывков с возможностью привязки к конкретному голосу озвучки.

## Параметры запроса

| Параметр | Тип | Обязательный | Описание | Пример |
|----------|-----|--------------|----------|--------|
| translation | integer | Да | Код перевода Библии | 1 |
| excerpt | string | Да | Строка с указанием отрывка в формате "книга глава[:стих[-стих]]" | "gen 1", "gen 1:1-3" |
| voice | integer | Нет | Код голоса озвучки для получения временной разметки | 5 |

## Форматы параметра excerpt

* `"gen 1"` - вся первая глава книги Бытие
* `"gen 1:1"` - только первый стих первой главы книги Бытие
* `"gen 1:1-5"` - стихи с 1 по 5 первой главы книги Бытие
* `"gen 1 ex 20"` - несколько отрывков (первая глава Бытия и 20-я глава Исхода)

## Структура ответа

```json
{
  "title": "Бытие 1",
  "is_single_chapter": true,
  "parts": [
    {
      "book": {
        "code": 123,
        "number": 1,
        "alias": "gen",
        "name": "Бытие",
        "chapters_count": 50
      },
      "chapter_number": 1,
      "audio_link": "https://example.com/audio/syn/gen/01.mp3",
      "prev_excerpt": "",
      "next_excerpt": "gen 2",
      "verses": [
        {
          "code": 456,
          "number": 1,
          "join": 0,
          "text": "В начале сотворил Бог небо и землю.",
          "html": "<p>В начале сотворил Бог небо и землю.</p>",
          "begin": 0.0,
          "end": 4.25,
          "start_paragraph": true
        }
      ],
      "notes": [
        {
          "code": 789,
          "number": 1,
          "text": "Примечание к тексту",
          "verse_code": 456,
          "title_code": null,
          "position_text": 10,
          "position_html": 15
        }
      ],
      "titles": [
        {
          "code": 321,
          "text": "Сотворение мира",
          "before_verse_code": 456,
          "metadata": null,
          "reference": null
        }
      ]
    }
  ]
}
```

## Основные поля ответа

* **title** - заголовок отрывка
* **is_single_chapter** - флаг, указывающий является ли отрывок одной главой
* **parts** - массив частей отрывка (для каждой запрошенной главы)

## Поля части отрывка (parts)

* **book** - информация о книге (код, номер, название, алиас, количество глав)
* **chapter_number** - номер главы
* **audio_link** - ссылка на аудиофайл с озвучкой
* **prev_excerpt** - ссылка на предыдущий отрывок (в формате "книга глава")
* **next_excerpt** - ссылка на следующий отрывок (в формате "книга глава")
* **verses** - массив стихов с временной разметкой
* **notes** - массив примечаний к тексту
* **titles** - массив заголовков в тексте

## Поля стиха (verses)

* **code** - уникальный код стиха
* **number** - номер стиха
* **join** - номер стиха для объединения (если стихи объединены)
* **text** - текст стиха без HTML-разметки
* **html** - текст стиха с HTML-разметкой
* **begin** - время начала стиха в аудиофайле (в секундах)
* **end** - время окончания стиха в аудиофайле (в секундах)
* **start_paragraph** - флаг начала абзаца

## Коды ошибок

* **422** - Ошибка валидации параметров:
  * Перевод не найден
  * Голос не найден для указанного перевода
  * Неверный формат отрывка
  * Книга не найдена
  * Стихи не найдены для указанного отрывка

## Примеры запросов

1. Получение первой главы Бытия с озвучкой:
   ```
   GET /excerpt_with_alignment?translation=1&excerpt=gen%201&voice=5
   ```

2. Получение стихов 1-3 из первой главы Бытия:
   ```
   GET /excerpt_with_alignment?translation=1&excerpt=gen%201:1-3&voice=5
   ```

3. Получение нескольких отрывков:
   ```
   GET /excerpt_with_alignment?translation=1&excerpt=gen%201%20ex%2020&voice=5
   ```
